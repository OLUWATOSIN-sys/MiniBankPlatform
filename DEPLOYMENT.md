# 🚀 Deployment Guide - MiniBank Platform

This guide explains how to deploy your MiniBank platform to production using Render (backend) and Vercel (frontend).

## 📋 **Prerequisites**

- GitHub repository: `git@github.com:OLUWATOSIN-sys/MiniBankPlatform.git`
- Render account (free tier)
- Vercel account (free tier)

## 🏗️ **Architecture**

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Vercel        │    │   Render        │    │   Render        │
│   (Frontend)    │───▶│   (Backend)     │───▶│   (PostgreSQL)  │
│   Next.js       │    │   NestJS        │    │   Database      │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

## 🔧 **Step 1: Push to GitHub**

```bash
# Initialize git if not already done
git init
git remote add origin git@github.com:OLUWATOSIN-sys/MiniBankPlatform.git

# Add all files
git add .
git commit -m "Initial commit: MiniBank Platform with PostgreSQL"
git push -u origin main
```

## 🎯 **Step 2: Deploy Backend to Render**

### 2.1 **Create New Web Service**

1. Go to [Render Dashboard](https://dashboard.render.com)
2. Click **"New"** → **"Web Service"**
3. Connect your GitHub repository: `OLUWATOSIN-sys/MiniBankPlatform`

### 2.2 **Configure Web Service**

```yaml
Name: minibank-backend
Runtime: Node
Build Command: cd backend && npm install && npm run build
Start Command: cd backend && npm run start:prod
```

### 2.3 **Environment Variables**

Add these in Render dashboard:

```env
NODE_ENV=production
PORT=10000
JWT_SECRET=your-super-secure-jwt-secret-here
JWT_EXPIRATION=24h
USD_TO_EUR_RATE=0.92
FRONTEND_URL=https://mini-bank-platform.vercel.app
```

### 2.4 **Create PostgreSQL Database**

1. In Render dashboard: **"New"** → **"PostgreSQL"**
2. Name: `minibank-postgres`
3. Database Name: `minibank`
4. User: `minibank`
5. Plan: **Free**

### 2.5 **Connect Database to Backend**

1. Go to your web service settings
2. Add environment variable:
   ```
   DATABASE_URL = [Copy from PostgreSQL dashboard - Internal Database URL]
   ```

## 🌐 **Step 3: Deploy Frontend to Vercel**

### 3.1 **Connect Repository**

1. Go to [Vercel Dashboard](https://vercel.com/dashboard)
2. Click **"Add New"** → **"Project"**
3. Import `OLUWATOSIN-sys/MiniBankPlatform`

### 3.2 **Configure Project**

```yaml
Framework Preset: Next.js
Root Directory: frontend
Build Command: npm run build
Output Directory: .next (default)
Install Command: npm install
```

### 3.3 **Environment Variables**

Add in Vercel project settings:

```env
NEXT_PUBLIC_API_URL=https://minibank-backend.onrender.com
```

### 3.4 **Domain Settings**

- Vercel will auto-generate: `mini-bank-platform.vercel.app`
- You can customize the domain in project settings

## 🚀 **Step 4: Auto-Deployment Setup**

Both services are now configured for **automatic deployment**:

### ✅ **Push to Deploy**
```bash
git add .
git commit -m "Update feature"
git push origin main
```

**What happens automatically:**
1. 🔄 GitHub webhook triggers deployment
2. 🏗️ Render builds and deploys backend
3. 🌐 Vercel builds and deploys frontend
4. ✅ Both services update with zero downtime

## 📊 **Step 5: Verification**

### 5.1 **Test Backend**
```bash
curl https://minibank-backend.onrender.com
# Should return: {"message": "MiniBank API is running!"}

curl https://minibank-backend.onrender.com/api
# Should show Swagger documentation
```

### 5.2 **Test Frontend**
Visit: `https://mini-bank-platform.vercel.app`

Expected:
- ✅ Login page loads
- ✅ Can register new account
- ✅ Dashboard shows balances
- ✅ Transfers work between users
- ✅ Currency exchange works

### 5.3 **Test Database**
```bash
# Check database connection
curl -X POST https://minibank-backend.onrender.com/auth/register \\
  -H "Content-Type: application/json" \\
  -d '{
    "email": "test@example.com",
    "password": "password123",
    "firstName": "Test",
    "lastName": "User"
  }'
```

## 🔒 **Step 6: Security Configuration**

### 6.1 **Environment Variables Security**

**✅ Secure (in Render/Vercel dashboard):**
- `JWT_SECRET` - Auto-generated by Render
- `DATABASE_URL` - Auto-injected by Render

**⚠️ Never commit:**
- Production passwords
- API keys
- Database credentials

### 6.2 **CORS Configuration**

Backend automatically allows:
- `https://mini-bank-platform.vercel.app`
- Custom domains you add to Vercel

## 📈 **Step 7: Monitoring**

### 7.1 **Render Monitoring**
- View logs: Render dashboard → Your service → Logs
- Monitor performance: Built-in metrics
- Set up alerts: Available in paid plans

### 7.2 **Vercel Monitoring**
- Analytics: Vercel dashboard → Analytics
- Function logs: Functions tab
- Performance insights: Built-in

## 🔄 **Step 8: Updates & Maintenance**

### 8.1 **Code Updates**
```bash
# Make changes
git add .
git commit -m "Feature: Add new banking feature"
git push origin main
# ✅ Auto-deploys to both services
```

### 8.2 **Database Migrations**
```bash
# For schema changes, add migration
npm run migration:generate -- -n AddNewFeature
# Push to trigger deployment with migration
```

### 8.3 **Rollback**
```bash
# Revert to previous commit
git revert HEAD
git push origin main
# ✅ Auto-deploys previous version
```

## 📞 **Troubleshooting**

### Backend Issues
1. **Check Render logs**: Dashboard → Service → Logs
2. **Database connection**: Verify `DATABASE_URL` is set
3. **Environment vars**: Ensure all required vars are set

### Frontend Issues  
1. **Check Vercel logs**: Dashboard → Functions → View Function Logs
2. **API connection**: Verify `NEXT_PUBLIC_API_URL` points to Render
3. **Build errors**: Check build logs in deployment tab

### Database Issues
1. **Connection**: Test DATABASE_URL connection
2. **Migrations**: Ensure migrations ran successfully  
3. **Seeds**: Check if initial data was created

## 🎉 **Success!**

Your MiniBank platform is now:
- ✅ **Live in production**
- ✅ **Auto-deploying** on every push
- ✅ **Fully scalable** on cloud infrastructure
- ✅ **Monitored** with built-in analytics
- ✅ **Secure** with proper environment variables

## 🔗 **Production URLs**

- **Frontend**: https://mini-bank-platform.vercel.app
- **Backend**: https://minibank-backend.onrender.com  
- **API Docs**: https://minibank-backend.onrender.com/api
- **Database**: Managed PostgreSQL on Render

**Total Setup Time**: ~15 minutes
**Cost**: $0 (Free tiers for both services)
